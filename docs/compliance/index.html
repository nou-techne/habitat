<!DOCTYPE html>
<html lang="en">
<head>
  <script>(function(){var t=localStorage.getItem("theme");if(t==="dark"||(!t&&window.matchMedia("(prefers-color-scheme:dark)").matches))document.documentElement.setAttribute("data-theme","dark")})()</script>
  <meta charset="UTF-8">
  <link rel="icon" href="/favicon.svg" type="image/svg+xml">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Interactive IRC Section 704(b) compliance checker. Input allocation scenarios and test against the substantial economic effect requirements.">
  <link rel="canonical" href="https://the-habitat.org/compliance/">
  <title>704(b) Compliance Checker — Habitat</title>
  <link rel="stylesheet" href="../style.css">
  <meta property="og:title" content="704(b) Compliance Checker — Habitat">
  <meta property="og:description" content="Interactive tool demonstrating IRC Section 704(b) compliance rules for cooperative patronage allocations.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://the-habitat.org/compliance/">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="704(b) Compliance Checker — Habitat">
  <meta name="twitter:description" content="See how allocations satisfy or violate the 704(b) economic effect test.">
  <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
  <a href="#main" class="skip-to-main">Skip to main content</a>
    <nav>
    <a href="/" class="logo">Habitat</a>
    <button class="nav-hamburger" onclick="toggleMobileNav()" aria-label="Toggle navigation">
      <i data-lucide="menu"></i>
    </button>
    <div class="links" id="nav-links">
      <a href="/">Home</a>
      <a href="/about/">About</a>
      <a href="/agents/">Agents</a>
      <a href="/journal/">Journal</a>
      <div class="nav-dropdown">
        <div class="nav-dropdown-toggle" onclick="toggleDropdown(event)">
          Learn
          <i data-lucide="chevron-down"></i>
        </div>
        <div class="nav-dropdown-menu">
          <a href="/thesis/">Thesis</a>
          <a href="/patterns/">Patterns</a>
          <a href="/matrix/">Matrix</a>
          <a href="/glossary/">Glossary</a>
        </div>
      </div>
      <div class="nav-dropdown">
        <div class="nav-dropdown-toggle" onclick="toggleDropdown(event)">
          System
          <i data-lucide="chevron-down"></i>
        </div>
        <div class="nav-dropdown-menu">
          <a href="/patronage/">Patronage</a>
          <a href="/identity/">Identity</a>
          <a href="/compliance/">Compliance</a>
          <a href="/license/">License</a>
        </div>
      </div>
    </div>
      <div class="nav-search">
        <input type="text" id="search-input" placeholder="Search..." autocomplete="off">
        <span class="nav-search-icon"><i data-lucide="search"></i></span>
        <div id="search-results" class="search-results"></div>
      </div>
    </div>
  </nav>
  <script src="/search.js"></script>
  <script>
    function toggleMobileNav() {
      document.getElementById('nav-links').classList.toggle('mobile-open');
    }
    function toggleDropdown(e) {
      e.stopPropagation();
      const dropdown = e.target.closest('.nav-dropdown');
      const wasOpen = dropdown.classList.contains('open');
      document.querySelectorAll('.nav-dropdown').forEach(d => d.classList.remove('open'));
      if (!wasOpen) dropdown.classList.add('open');
    }
    document.addEventListener('click', () => {
      document.querySelectorAll('.nav-dropdown').forEach(d => d.classList.remove('open'));
    });
  </script>

  <div class="band band-dark-section">
    <div class="prose" id="main" style="padding-top: 4rem; padding-bottom: 2rem;">
      <h1>704(b) Compliance Checker</h1>
      <p class="lead">Interactive demonstration of IRC Section 704(b) compliance rules. Input an allocation scenario and see which tests pass or fail.</p>
    </div>
  </div>

  <div class="prose" style="padding-top: 3rem;">
    <h2>The Three-Part Test</h2>
    <p>For a partnership (or LCA) allocation to have "substantial economic effect" under IRC Section 704(b), it must satisfy three requirements:</p>

    <ol>
      <li><strong>Capital account maintenance</strong> — properly track each partner's economic interest</li>
      <li><strong>Liquidation proceeds follow capital accounts</strong> — distributions match economic rights</li>
      <li><strong>Deficit restoration obligation (DRO) or qualified income offset (QIO)</strong> — protection against negative balances</li>
    </ol>

    <p>Input a scenario below to test compliance:</p>

    <div id="checker" style="margin: 2rem 0;">
      <div style="background:var(--card-bg);border:1px solid var(--border);border-radius:8px;padding:1.5rem;margin-bottom:1.5rem;">
        <h3 style="margin-top:0;">Scenario Inputs</h3>
        
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;margin-bottom:1.5rem;">
          <div>
            <label style="display:block;font-size:0.85rem;font-weight:600;margin-bottom:0.3rem;color:var(--text-muted);">Member A Contribution</label>
            <input type="number" id="contrib-a" value="10000" min="0" step="1000" oninput="checkCompliance()" style="width:100%;padding:0.5rem;border:1px solid var(--border);border-radius:4px;font-size:0.9rem;">
          </div>
          <div>
            <label style="display:block;font-size:0.85rem;font-weight:600;margin-bottom:0.3rem;color:var(--text-muted);">Member B Contribution</label>
            <input type="number" id="contrib-b" value="5000" min="0" step="1000" oninput="checkCompliance()" style="width:100%;padding:0.5rem;border:1px solid var(--border);border-radius:4px;font-size:0.9rem;">
          </div>
        </div>

        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;margin-bottom:1.5rem;">
          <div>
            <label style="display:block;font-size:0.85rem;font-weight:600;margin-bottom:0.3rem;color:var(--text-muted);">Period Net Income</label>
            <input type="number" id="net-income" value="6000" step="1000" oninput="checkCompliance()" style="width:100%;padding:0.5rem;border:1px solid var(--border);border-radius:4px;font-size:0.9rem;">
          </div>
          <div>
            <label style="display:block;font-size:0.85rem;font-weight:600;margin-bottom:0.3rem;color:var(--text-muted);">Member A Allocation %</label>
            <input type="number" id="alloc-a" value="60" min="0" max="100" oninput="checkCompliance()" style="width:100%;padding:0.5rem;border:1px solid var(--border);border-radius:4px;font-size:0.9rem;">
          </div>
        </div>

        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;">
          <div>
            <label style="display:flex;align-items:center;gap:0.5rem;font-size:0.9rem;cursor:pointer;">
              <input type="checkbox" id="dro-a" checked onchange="checkCompliance()" style="width:16px;height:16px;">
              Member A has DRO
            </label>
          </div>
          <div>
            <label style="display:flex;align-items:center;gap:0.5rem;font-size:0.9rem;cursor:pointer;">
              <input type="checkbox" id="dro-b" checked onchange="checkCompliance()" style="width:16px;height:16px;">
              Member B has DRO
            </label>
          </div>
        </div>
      </div>

      <div style="background:var(--card-bg);border:1px solid var(--border);border-radius:8px;padding:1.5rem;margin-bottom:1.5rem;">
        <h3 style="margin-top:0;">Capital Accounts (After Allocation)</h3>
        <table style="width:100%;border-collapse:collapse;font-size:0.9rem;">
          <thead>
            <tr>
              <th style="text-align:left;padding:0.5rem;border-bottom:2px solid var(--border);">Member</th>
              <th style="text-align:right;padding:0.5rem;border-bottom:2px solid var(--border);">Contribution</th>
              <th style="text-align:right;padding:0.5rem;border-bottom:2px solid var(--border);">Allocation</th>
              <th style="text-align:right;padding:0.5rem;border-bottom:2px solid var(--border);">Balance</th>
            </tr>
          </thead>
          <tbody id="cap-accounts"></tbody>
        </table>
      </div>

      <div id="compliance-results"></div>
    </div>

    <style>
      .test-result {
        background: var(--card-bg);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 1.5rem;
        margin-bottom: 1rem;
      }
      .test-result.pass {
        border-left: 4px solid var(--accent);
        background: rgba(74,124,89,0.05);
      }
      .test-result.fail {
        border-left: 4px solid var(--accent-orange);
        background: rgba(181,98,42,0.05);
      }
      .test-result h4 {
        margin:0 0 0.5rem;
        display:flex;
        align-items:center;
        gap:0.5rem;
        font-size:1rem;
      }
      .test-result.pass h4 { color: var(--accent); }
      .test-result.fail h4 { color: var(--accent-orange); }
      .test-result p {
        margin:0;
        font-size:0.9rem;
        color:var(--text-muted);
      }
    </style>

    <script>
      function checkCompliance() {
        const contribA = +document.getElementById('contrib-a').value || 0;
        const contribB = +document.getElementById('contrib-b').value || 0;
        const netIncome = +document.getElementById('net-income').value || 0;
        const allocPctA = +document.getElementById('alloc-a').value || 0;
        const allocPctB = 100 - allocPctA;
        const droA = document.getElementById('dro-a').checked;
        const droB = document.getElementById('dro-b').checked;

        const allocA = (netIncome * allocPctA / 100);
        const allocB = (netIncome * allocPctB / 100);
        const balanceA = contribA + allocA;
        const balanceB = contribB + allocB;

        // Update capital accounts table
        const tbody = document.getElementById('cap-accounts');
        tbody.innerHTML = `
          <tr>
            <td style="padding:0.5rem;border-bottom:1px solid var(--border);font-weight:600;">Member A</td>
            <td style="padding:0.5rem;border-bottom:1px solid var(--border);text-align:right;font-variant-numeric:tabular-nums;">$${contribA.toLocaleString()}</td>
            <td style="padding:0.5rem;border-bottom:1px solid var(--border);text-align:right;font-variant-numeric:tabular-nums;">$${allocA.toLocaleString(undefined,{minimumFractionDigits:0,maximumFractionDigits:0})}</td>
            <td style="padding:0.5rem;border-bottom:1px solid var(--border);text-align:right;font-weight:600;font-variant-numeric:tabular-nums;">$${balanceA.toLocaleString(undefined,{minimumFractionDigits:0,maximumFractionDigits:0})}</td>
          </tr>
          <tr>
            <td style="padding:0.5rem;border-bottom:1px solid var(--border);font-weight:600;">Member B</td>
            <td style="padding:0.5rem;border-bottom:1px solid var(--border);text-align:right;font-variant-numeric:tabular-nums;">$${contribB.toLocaleString()}</td>
            <td style="padding:0.5rem;border-bottom:1px solid var(--border);text-align:right;font-variant-numeric:tabular-nums;">$${allocB.toLocaleString(undefined,{minimumFractionDigits:0,maximumFractionDigits:0})}</td>
            <td style="padding:0.5rem;border-bottom:1px solid var(--border);text-align:right;font-weight:600;font-variant-numeric:tabular-nums;">$${balanceB.toLocaleString(undefined,{minimumFractionDigits:0,maximumFractionDigits:0})}</td>
          </tr>
        `;

        // Run tests
        const tests = [];

        // Test 1: Capital account maintenance
        const test1Pass = (contribA >= 0 && contribB >= 0);
        tests.push({
          name: "Capital Account Maintenance",
          pass: test1Pass,
          message: test1Pass 
            ? "Capital accounts properly track each member's contributions and allocations."
            : "Capital accounts must accurately reflect economic contributions."
        });

        // Test 2: Liquidation proceeds follow capital accounts
        const totalCap = balanceA + balanceB;
        const test2Pass = totalCap > 0 && (balanceA / totalCap) > 0 && (balanceB / totalCap) > 0;
        tests.push({
          name: "Liquidation Distribution Matches Capital",
          pass: test2Pass,
          message: test2Pass
            ? `On liquidation, Member A would receive ${((balanceA/totalCap)*100).toFixed(1)}% and Member B would receive ${((balanceB/totalCap)*100).toFixed(1)}%, matching their capital account balances.`
            : "Liquidation proceeds must be distributed according to positive capital account balances."
        });

        // Test 3: DRO or QIO
        const test3Pass = (droA || balanceA >= 0) && (droB || balanceB >= 0);
        tests.push({
          name: "Deficit Protection (DRO/QIO)",
          pass: test3Pass,
          message: test3Pass
            ? "All members with potential negative balances have deficit restoration obligations."
            : "Members without DRO cannot have allocations that could create negative capital accounts."
        });

        // Test 4: Substantiality (simplified: allocation must correlate with economic contribution)
        const totalContrib = contribA + contribB;
        const contribPctA = totalContrib > 0 ? (contribA / totalContrib) * 100 : 50;
        const allocDiff = Math.abs(allocPctA - contribPctA);
        const test4Pass = allocDiff < 40; // Allow some variance, but not extreme
        tests.push({
          name: "Substantiality Test",
          pass: test4Pass,
          message: test4Pass
            ? `Allocation (${allocPctA.toFixed(1)}%) reasonably correlates with economic contribution (${contribPctA.toFixed(1)}%).`
            : `Allocation (${allocPctA.toFixed(1)}%) diverges significantly from economic contribution (${contribPctA.toFixed(1)}%). Allocations must have economic substance beyond tax benefits.`
        });

        // Render results
        const resultsDiv = document.getElementById('compliance-results');
        const allPass = tests.every(t => t.pass);
        resultsDiv.innerHTML = `
          <div style="background:${allPass ? 'rgba(74,124,89,0.1)' : 'rgba(181,98,42,0.1)'};border:1px solid ${allPass ? 'rgba(74,124,89,0.3)' : 'rgba(181,98,42,0.3)'};border-radius:8px;padding:1.5rem;margin-bottom:1.5rem;">
            <h3 style="margin-top:0;display:flex;align-items:center;gap:0.5rem;color:${allPass ? 'var(--accent)' : 'var(--accent-orange)'};">
              <i data-lucide="${allPass ? 'check-circle' : 'alert-circle'}" style="width:20px;height:20px;stroke-width:1.5;"></i>
              Overall: ${allPass ? 'Compliant' : 'Non-Compliant'}
            </h3>
            <p style="margin:0;font-size:0.9rem;color:var(--text-muted);">
              ${allPass 
                ? 'This allocation scenario satisfies all IRC 704(b) requirements for substantial economic effect.' 
                : 'This allocation scenario fails one or more 704(b) tests and would not be respected by the IRS.'}
            </p>
          </div>
          ${tests.map(test => `
            <div class="test-result ${test.pass ? 'pass' : 'fail'}">
              <h4>
                <i data-lucide="${test.pass ? 'check' : 'x'}" style="width:16px;height:16px;stroke-width:2;"></i>
                ${test.name}
              </h4>
              <p>${test.message}</p>
            </div>
          `).join('')}
        `;
        lucide.createIcons();
      }

      document.addEventListener('DOMContentLoaded', checkCompliance);
    </script>

    <h2>Understanding 704(b)</h2>
    <p>IRC Section 704(b) governs how partnerships (and LCAs) allocate income, gain, loss, and deduction among partners. The law requires that allocations have "substantial economic effect" — meaning they reflect real economic arrangements, not just tax optimization.</p>

    <p>The three-part test ensures that:</p>
    <ul>
      <li>Members' economic interests are properly tracked (capital accounts)</li>
      <li>Distributions match those economic interests (liquidation test)</li>
      <li>Members bear the risk of their allocations (DRO/QIO)</li>
    </ul>

    <p>The substantiality test prevents purely tax-motivated allocations. If Member A contributes 67% of the capital but receives 95% of the income allocation with no economic justification, the IRS will disregard the allocation and reallocate according to economic reality.</p>

    <p>For cooperatives using patronage-based allocation, compliance is straightforward: contributions and patronage create real economic interests, allocations follow the patronage formula, and liquidation proceeds distribute according to capital accounts. The system is designed for compliance.</p>

    <h2>Further Reading</h2>
    <ul>
      <li><a href="/patronage/" style="color:var(--accent);">Patronage Accounting</a> — How Habitat's system satisfies 704(b) by design</li>
      <li><a href="https://www.irs.gov/pub/irs-pdf/p541.pdf" style="color:var(--accent);">IRS Publication 541</a> — Partnerships (PDF)</li>
    </ul>

  </div>

  <footer>
    <div class="footer-links">
      <a href="https://github.com/nou-techne/habitat">GitHub</a>
      <a href="/about/">About</a>
      <a href="/faq/">FAQ</a>
      <a href="/glossary/">Glossary</a>
      <a href="/license/">License</a>
    </div>
    <div class="footer-tagline">Where the Great Plains meet the Rocky Mountains, 5,430 feet</div>
    <div style="font-size:0.8rem;color:var(--text-muted);margin-top:0.5rem;">&copy; 2026 Techne / RegenHub, LCA</div>
  </footer>
  <!-- Text Size Adjustment Tool -->
  <div class="site-controls">
  <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle dark mode">
    <span class="icon-sun"><i data-lucide="sun"></i></span>
    <span class="icon-moon"><i data-lucide="moon"></i></span>
  </button>
  <div class="text-size-control">
    <button class="text-size-btn" onclick="adjustTextSize('decrease')" aria-label="Decrease text size">
      <i data-lucide="minus"></i>
    </button>
    <button class="text-size-btn active" onclick="adjustTextSize('reset')" aria-label="Reset text size">
      <i data-lucide="type"></i>
    </button>
    <button class="text-size-btn" onclick="adjustTextSize('increase')" aria-label="Increase text size">
      <i data-lucide="plus"></i>
    </button>
  </div>
  <script>
  (function() {
    const sizes = ['small', 'normal', 'large'];
    const fontSizes = { small: '15px', normal: '16px', large: '18px' };
    
    function adjustTextSize(action) {
      let currentSize = localStorage.getItem('textSize') || 'normal';
      let newSize = currentSize;
      
      if (action === 'decrease') {
        if (currentSize === 'normal') newSize = 'small';
        else if (currentSize === 'large') newSize = 'normal';
      } else if (action === 'increase') {
        if (currentSize === 'small') newSize = 'normal';
        else if (currentSize === 'normal') newSize = 'large';
      } else if (action === 'reset') {
        newSize = 'normal';
      }
      
      localStorage.setItem('textSize', newSize);
      applyTextSize(newSize);
      updateButtons(newSize);
    }
    
    function applyTextSize(size) {
      document.documentElement.style.fontSize = fontSizes[size];
    }
    
    function updateButtons(size) {
      const buttons = document.querySelectorAll('.text-size-btn');
      buttons.forEach(btn => btn.classList.remove('active'));
      
      if (size === 'small') buttons[0].classList.add('active');
      else if (size === 'normal') buttons[1].classList.add('active');
      else if (size === 'large') buttons[2].classList.add('active');
    }
    
    // Initialize on page load
    const savedSize = localStorage.getItem('textSize') || 'normal';
    applyTextSize(savedSize);
    
    // Update buttons after lucide icons are loaded
    document.addEventListener('DOMContentLoaded', () => {
      updateButtons(savedSize);
    });
    
    // Make function globally available
    window.adjustTextSize = adjustTextSize;
  })();
  </script>

  </div><!-- /site-controls -->
  <script>
  (function() {
    function toggleTheme() {
      var isDark = document.documentElement.getAttribute("data-theme") === "dark";
      var newTheme = isDark ? "light" : "dark";
      document.documentElement.setAttribute("data-theme", newTheme);
      localStorage.setItem("theme", newTheme);
      lucide.createIcons();
    }
    var saved = localStorage.getItem("theme");
    if (saved === "dark" || (!saved && window.matchMedia("(prefers-color-scheme: dark)").matches)) {
      document.documentElement.setAttribute("data-theme", "dark");
    }
    window.toggleTheme = toggleTheme;
  })();
  </script>

  <script>lucide.createIcons();</script>
</body>
</html>
